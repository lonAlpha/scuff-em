#!/bin/bash

#################################################################
#################################################################
#################################################################
if [ "x$1" == "x--debug" ]
then
  DIR=${SEDB}
  PREFIX="gdb --args"
  shift
elif [ "x$1" == "x--valgrind" ]
then
  DIR=${SEDB}
  PREFIX="valgrind"
  shift
else
  DIR=${SEI}
  PREFIX=""
fi

#################################################################
#################################################################
#################################################################
DIR=${SEI}
CODE=scuff-static

GEOM=StriplineCapacitor_Air

#################################################################
#################################################################
#################################################################
N=4 # meshing fineness
/bin/rm ${GEOM}.CapVsT
for N in 2 4
do
for W in 0.5 1.0
do
for T in `cat TFile`
do

  #################################################################
  #################################################################
  #################################################################
  gmsh -2 -setnumber N ${N} -setnumber T ${T} -setnumber W ${W} ${GEOM}.geo
  NUMEDGES=`scuff-analyze --mesh ${GEOM}.msh  | grep 'interior edges' | head -1 | cut -f2 -d' '`

  #################################################################
  #################################################################
  #################################################################
  echo "T=${T}: NumEdges=${NUMEDGES}"
  #/bin/rm "${GEOM}.CapMatrix"

  ARGS=""
  ARGS="${ARGS} --geometry ${GEOM}.scuffgeo"
  ARGS="${ARGS} --CapFile  ${GEOM}.CapMatrix"
  ${PREFIX} ${DIR}/${CODE} ${ARGS}

  LINE=`tail -1 ${GEOM}.CapMatrix`
  echo "${T} ${LINE}" >> ${GEOM}.N${N}.CapVsT

done
done
done
